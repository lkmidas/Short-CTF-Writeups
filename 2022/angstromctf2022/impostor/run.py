vm_code = bytes.fromhex("CA5F91AE6152BF838C49ECB5BA8514F5064FBAA3A4D032EF0BD52650012FF8B63F0E3709E4D68C4E7EC51705AA2308B78A4E6CBA16A3C78D595C2D71A73374A89DB38AA422A0FE4491FC16660CBCBD52F871A316A985D9718F08E1C8CD2D8E64434C2DDE7A150FC3E0E4E2AF65E38738D514AA977898285AE8E1474B7393C364EEDBA876115BD56324A9F62711313F8FC2793B5836B0F0B9059524BCD2BB6C32CB1747A807360B6FAC2EAC36A33D6AC81069F245618BEA8B58836A6246C2E73A6F02D6D244983166799E025D2ABA9AA56E6404D1C3E8459B23EB3998C35505F60A503CFF")#000000005D50957C1B6C584FC6807C77")
flag = bytearray(b"actf{l_plus_ratio_plus_no_flags}")

rand_arr_0 = [1804289383, 846930886, 1681692777, 1714636915, 1957747793, 424238335, 719885386, 1649760492, 596516649, 1189641421, 1025202362, 1350490027, 783368690, 1102520059, 2044897763, 1967513926, 1365180540, 1540383426, 304089172, 1303455736, 35005211, 521595368, 294702567, 1726956429, 336465782, 861021530, 278722862, 233665123, 2145174067, 468703135, 1101513929, 1801979802]
rand_arr_1 = [1804289383, 846930886, 1681692777, 1714636915, 1957747793, 424238335, 719885386, 1649760492, 596516649, 1189641421, 1025202362, 1350490027, 783368690, 1102520059, 2044897763, 1967513926, 1365180540, 1540383426, 304089172, 1303455736, 35005211, 521595368, 294702567, 1726956429, 336465782, 861021530, 278722862, 233665123, 2145174067, 468703135, 1101513929, 1801979802]
rand_arr_2 = [1505335290, 1738766719, 190686788, 260874575, 747983061, 906156498, 1502820864, 142559277, 1261608745, 1380759627, 2127304342, 635050179, 582691149, 149585093, 2039335037, 820715049, 693014654, 2122498773, 1809302367, 591232730, 1281246002, 1194903572, 1820868569, 396476315, 853559767, 1910751391, 1826393210, 682319630, 221122296, 96423063, 1385108013, 1726457586]
def shuffle(arr, b, c):
    v6 = 0
    for i in range(32):
        v7 = c[i] + v6
        v6 *= b
        v4 = arr[v7 % 32]
        arr[v7 % 32] = arr[v6 % 32]
        arr[v6 % 32] = v4

size = 32
v9 = 0
v10 = 0
ptr = bytearray(b"")
for i in range(0, len(vm_code), 4):
    inst = bin(int.from_bytes(vm_code[i:i+4], "little")).count('1') - 11

    if (inst <= 8):
        v10 += 8
        if inst == 1:
            shuffle(flag, 1, rand_arr_1)
        elif inst == 2:
            ptr += flag
        elif inst == 3:
            shuffle(flag, 2, rand_arr_2)
        elif inst == 5:
            size *= 2
        elif inst == 6:
            shuffle(flag, 0, rand_arr_0)
        elif inst == 7:
            size = 32
            size *= 2
        elif (inst == 0) or (inst == 4):
            pass
        else:
            print("ERROR", inst)
    else:
        for i in range(size // 2):
            if i >= len(ptr):
                break
            ptr[i] = (ptr[i] * inst) & 0xff
for i in range(32):
    flag[i] = 0
j = 0
for i in range(size // 2):
    if i >= len(ptr):
        break
    flag[j % 32] ^= ptr[i]
    j = i + 1

key = bytearray((0x8C0A3EFC87E57E8C660A7262DAB5E734D2DA506ACC8015215646564D6104635F).to_bytes(32, byteorder='little'))
for i in range(32):
    flag[i] ^= key[i]

print(flag)
